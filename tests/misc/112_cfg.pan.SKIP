length : (s:ğ•Š) â†’ { n:â„¤ | n â‰¥ 0 âˆ§ n = |s| }
charAt : (s:ğ•Š) â†’ { i:â„¤ | i â‰¥ 0 âˆ§ i < |s| } â†’ { t:char | t = s[i] }
match  : (s:char) â†’ (t:char) â†’ { b:ğ”¹ | b = true âŸº s = t }

add : (a:â„¤) â†’ (b:â„¤) â†’ { c:â„¤ | c = a + b }
lt : (a:â„¤) â†’ (b:â„¤) â†’ { c:ğ”¹ | c = true âŸº a < b }
eq : (a:â„¤) â†’ (b:â„¤) â†’ { c:ğ”¹ | c = true âŸº a = b }

and : (a:ğ”¹) â†’ (b:ğ”¹) â†’ { c:ğ”¹ | c = true âŸº (a = true âˆ§ b = true) }
assert : { b:ğ”¹ | b = true } â†’ ğŸ™

parser = \s:ğ•Š.
    let n = length s in
    rec go1 : {i1:â„¤|?} â†’ {j1:â„¤|?} â†’ ğŸ™ = Î»i1:â„¤. Î»j1:â„¤.
      let p1 = lt i1 n in
      let x = charAt s i1 in
      let p2 = match x 'a' in
      let p3 = and p1 p2 in
      if p3 then
        let i2 = add i1 1 in
        let j2 = add j1 1 in 
        go1 i2 j2
      else
        rec go2 : {i3:â„¤|?} â†’ {k1:â„¤|?} â†’ ğŸ™ = Î»i3:â„¤. Î»k1:â„¤.
          let p4 = lt i3 n in
          let y = charAt s i3 in
          let p5 = match y 'b' in
          let p6 = and p4 p5 in
          if p6 then
            let i4 = add i3 1 in
            let k2 = add k1 1 in
            go2 i4 k2
          else
            let p7 = eq i3 n in
            let p8 = eq k1 j1 in
            let p9 = and p7 p8 in
            assert p9
        in
          go2 i1 0
    in
      go1 0 0
